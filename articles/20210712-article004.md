---
title: "React Hooksã®10ç¨®é¡ã‚’ç†è§£ã™ã‚‹ï¼ˆBasic: useContextï¼‰"
emoji: "ğŸ˜„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "react hooks"]
published: true
---

# React Hooksã®10ç¨®é¡ã‚’ç†è§£ã™ã‚‹ï¼ˆBasic: useContextï¼‰
## contextã®å¾©ç¿’

### contextã¨ã¯

- contextã¯ã€å„éšå±¤ã§æ‰‹å‹•ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å­ã«ã‚ãŸã™ã“ã¨ãªãã€component treeå†…ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™æ–¹æ³•ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã‚ã‚‹ã€‚

1. `React.createContext`

```javascript
const newContext = React.createContext(defaultValue);
```

- context objectã‚’ä½œæˆã™ã‚‹ã€‚ReactãŒã“ã®context objectãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹componentã‚’renderã™ã‚‹éš›ã«ã¯ã€treeå†…ã®æœ€ã‚‚è¿‘ã„ä¸Šä½ã®ä¸€è‡´ã™ã‚‹ `Provider` ã‹ã‚‰ç¾åœ¨ã®contextã‚’èª­ã¿å–ã‚‹ã€‚

- `defaultValue` å¼•æ•°ã¯ã€componentãŒtreeå†…ã®ä¸Šä½ã«å¯¾å¿œã™ã‚‹Providerã‚’æŒã£ã¦ã„ãªã„ã¨ãã®ã¿ã«ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

2. `Context.Provider`

```javascript
<NewContext.Provider value={...}>
```

- ã“ã®provider componentã¯ã€`value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å—ã‘å–ã‚Šã€å­è¦ç´ ã«ã‚ã‚‹consumer componentã¨æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
- providerã¯nestã—ã¦ï¼ˆã¾ã¨ã‚ã¦ï¼‰treeå†…ã®ã‚ˆã‚Šæ·±ã„ä½ç½®ã§å€¤ã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
- providerã®å­å­«ã®ã™ã¹ã¦ã®consumerã¯ã€providerã®`value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«å†renderã•ã‚Œã‚‹ã€‚

3. `Class.contextType`

- hooksã«ã¯ã‚ã¾ã‚Šé–¢ä¿‚ãªã„ãŸã‚çœç•¥

4. `Context.Consumer`

```javascript
<MyContext.Consumer>
  {value => ...}
</MyContext.Consumer>
```

- contextã®å¤‰æ›´ã‚’è³¼èª­ã™ã‚‹react componentã§ã‚ã‚‹ã€‚
- [function as a child](https://ja.reactjs.org/docs/render-props.html#using-props-other-than-render)ãŒå¿…è¦ã¨ãªã£ã¦ãã‚‹ã€‚
- å¼•æ•°`value`ã¯ã€treeå†…ã®ä¸Šä½ã§ä¸€ç•ªè¿‘ã„contextç”¨ã®providerã®`value`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ç­‰ã—ããªã‚‹ã€‚
- ä¸Šä½ã«å­˜åœ¨ã—ãªã„å ´åˆã€å¼•æ•°ã®`value`ã¯`createContext()`ã‹ã‚‰æ¸¡ã•ã‚ŒãŸ`defaultValue`ã¨ç­‰ã—ããªã‚‹ã€‚

### contextã«é–¢ã™ã‚‹æ³¨æ„äº‹é …

- contextã¯å‚ç…§ã®åŒä¸€æ€§ã‚’ä½¿ç”¨ã—ã¦ã„ã¤å†renderã™ã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã€providerã®è¦ªãŒå†renderã™ã‚‹ã¨ãã«consumerã§æ„å›³ã—ãªã„renderã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ãã®ãŸã‚ã€è¦ªã®stateã«valueã‚’ãƒªãƒ•ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚

#### before

```javascript
class App extends React.Component {
  render() {
    return (
      <MyContext.Provider value={{something: 'something' /* ã“ã“ãŒå•é¡Œ */}}>
        <Toolbar />
      </MyContext.Provider>
    );
  }
}
```

#### after

```javascript
class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      value: {something: 'something'}, // ã“ã®stateã«äºˆã‚valueã‚’è¨­ç½®
    };
  }

  render() {
    return (
      <MyContext.Provider value={this.state.value}>
        <Toolbar />
      </MyContext.Provider>
    );
  }
}
```

## `useContext`ã®åŸºæœ¬

```javascript
const value = useContext(MyContext);
```

- `React.createContext`ã‹ã‚‰ã®æˆ»ã‚Šå€¤ã‚’å—ã‘å–ã‚Šã€ãã®contextã®ç¾åœ¨åœ°ã‚’è¿”ã™ã€‚
- `MyContext.Provider`ã®valueã®å€¤ã«ã‚ˆã£ã¦contextã®ç¾åœ¨åœ°ãŒæ±ºå®šã•ã‚Œã‚‹ã€‚
- `MyContext.Provider`ãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã€ã“ã®hookã¯`MyContext`providerã«æ¸¡ã•ã‚ŒãŸæœ€æ–°ã®`value`ã‚’ä½¿ã£ã¦å†renderã‚’ç™ºç”Ÿã•ã›ã‚‹ã€‚
- `useContext`ã«ã‚ãŸã™å¼•æ•°ã¯**context objectãã‚Œè‡ªä½“**ã€‚
- `<MyContext.Consumer>`ã¨å½¹å‰²ã¯åŒç­‰ã€‚
- `useContext(MyContext)`ã¯ç¾åœ¨ã®contextã®å€¤ã‚’èª­ã¿å–ã‚Šã€ãã®å¤‰åŒ–ã‚’è³¼èª­ã™ã‚‹ã“ã¨ã—ã‹ã§ããªã„ã€‚ã‚ˆã£ã¦ã€`<MyContext.Provider`ãŒå¿…è¦ã¨ãªã£ã¦ãã‚‹ã€‚

### ä¾‹ç¤ºï¼ˆå…¬å¼ã‚ˆã‚ŠæŠœç²‹ï¼‰

```javascript
const themes = {
  light: {
    foreground: "#000000",
    background: "#eeeeee"
  },
  dark: {
    foreground: "#ffffff",
    background: "#222222"
  }
};

const ThemeContext = React.createContext(themes.light);

function App() {
  return (
    <ThemeContext.Provider value={themes.dark}>
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar(props) {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

function ThemedButton() {
  const theme = useContext(ThemeContext);
  return (
    <button style={{ background: theme.background, color: theme.foreground }}>
      I am styled by theme context!
    </button>
  );
}
```

## reference

- [ãƒ•ãƒƒã‚¯ API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://ja.reactjs.org/docs/hooks-reference.html)
- [ã™ã”ã„Reactãƒ•ãƒƒã‚¯8é¸](https://qiita.com/baby-degu/items/52dbb382bbaf6c43e2db)
- [React - context](https://ja.reactjs.org/docs/context.html)
